----------------DOCTOR,PATIENT,APPOINTMENT MODEL------------------

-- 1.display the doctor who does not have any appointments today--

select fname||' '||lname
from doctor
where doc_id not in (select doc_id
                     from case
                     where admission_date=sysdate);
                     
-- 2.display daywise no.of appointments in the current month--

select count(case_id),to_char(admission_Date,'dy')
from case
where to_char(admission_Date,'mm-yyyy')=to_char(sysdate,'mm-yyyy')
group by to_char(admission_Date,'dy');

-- 3.display top 2 doctors based on number of appointments from last three years--

select *
from (select fname||' '||lname,count(case_id),dense_rank()over(order by count(case_id) desc)rnk
      from doctor d,case c
      where d.doc_id=c.doc_id
      and to_char(admission_date,'yyyy')>to_char(sysdate,'yyyy')-3
      group by fname||' '||lname)a
where rnk=3;


-- 4.display the no of patients who have taken appointment more than 3 times in current year--

select count(p.pat_id),fname||' '||lname
from patient p,case c
where p.pat_id=c.pat_id 
and to_char(admission_date,'yy')=to_char(sysdate,'yy')
group by fname||' '||lname
having count(case_id)>3;

select * from patient;

-- 5.display the youngest patient based on age--

select min(trunc((sysdate-dob)/365))
from patient;

-- 6.display all the patients who treated by the doctor whom the patient 'arjun' was treated--

                             
select p.fname
from doctor d,case c,patient p
where d.doc_id=c.doc_id
and p.pat_id=c.pat_id
and d.fname = (select d.fname
               from case c,patient p,doctor d
               where d.doc_id=c.doc_id
               and p.pat_id=c.pat_id
               and p.fname='ARJUN');
                               
-- 7.extract gmail from emailid column--

select substr(email_id,instr(email_id,'@')+1,instr(email_id,'.')-instr(email_id,'@')-1) from doctor;

select * from doctor;

-- 8.display the common doctors whom 'arjun' and 'harish' was treated--

select d.fname
from doctor d,patient p,case c
where d.doc_id=c.doc_id
and p.pat_id=c.pat_id
and p.fname='arjun'
intersect
select d.fname
from doctor d,patient p,case c
where d.doc_id=c.doc_id
and p.pat_id=c.pat_id
and p.fname='harish';

-----------------BANKING MODEL---------------------------------------------------

--Write a query to display all the customer names who do not have a phone--

select cust_name 
from customer
where phone is null;


--Write a query to display all the customers and the number of accounts they hold--

select cust_name,count(a_no)
from customer c,accounts_t a
where c.cust_bkey=a.cust_bkey
group by cust_name;



--Display the customer who have the highest balance across all account types--
                                       
select cust_name,max(balance)
from customer c,accounts_t a
where c.cust_bkey=a.cust_bkey
group by cust_name
having max(balance)=(select max(balance)
                        from accounts_t);
                        
--Display the customer name who have the highest balance in individual account types--

select cust_name,balance,act_type
from customer c,accounts_t a
where c.cust_bkey=a.cust_bkey
and balance in (select max(balance)
                from accounts_t
                group by act_type);
                                       

--Display the State wise no of accounts opened in the previous year--

select state,count(a_no)
from customer c, accounts_t a
where c.cust_bkey=a.cust_bkey
and to_char(act_open_date,'yyyy')=to_char(sysdate,'yyyy')-1
group by state;

--Display the customers who hold more than 2 accounts of the same type--

select cust_name,act_type,count(a_no)
from customer c,accounts_t a
where c.cust_bkey=a.cust_bkey
group by cust_name,act_type
having count(a_no)>2;

--Display customer name and transaction type wise transaction amounts--

select cust_name,txn_type,sum(lcy_amt),sum(fcy_amt)
from customer c,accounts_t a,txn t
where c.cust_bkey=a.cust_bkey and a.a_no=t.a_no
group by txn_type,cust_name;

--Display city wise no of male and female customers--

select city,count(case when  gender='m' then gender
                  end)no_of_male,
            count(case when  gender='f' then gender
                  end)no_of_female
from customer
group by city;

--Display the customers who opened an account on birth day.--

select cust_name 
from customer c,accounts_t a
where c.cust_bkey=a.cust_bkey
and to_char(dob,'dd-mm')=to_char(act_open_date,'dd-mm');

--Display the account type wise no of customers and no of accounts opened in the current year.--

select act_type,count(c.cust_bkey)
from customer c,accounts_t a
where c.cust_bkey=a.cust_bkey
and to_char(act_open_date,'yyyy')=to_char(sysdate,'yyyy')
group by act_type;

--Display the youngest customer in each city.--

select cust_name,city
from customer
where (dob,city)in(select max(dob),city
                   from customer
                   group by city);

--Display customers who have their email in gmail domain.--

select cust_name
from customer
where email like '%gmail%';

--Display state wise no of accounts and no of transactions in the current year.--

select city,count(a.a_no),count(txn_id)
from customer c,accounts_t a ,txn t
where c.cust_bkey=a.cust_bkey
and a.a_no=t.a_no 
and to_char(act_open_date,'yyyy')=to_char(sysdate,'yyyy')
group by city;